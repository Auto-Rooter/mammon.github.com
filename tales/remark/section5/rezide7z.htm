<HTML>
<HEAD>
<!--  formamus.htm version 02 February 1998 
      INSTRUCTIONS FOR SUBMITTING: DO NOT USE HTML EDITORS!
      SEARCH THIS TEXT FOR THE STRING "Your_" 
      AND REPLACE WITH WHATEVER YOU WANT TO PUBLISH! 
      THANKS A LOT: this will allow automated retrieval -->
<TITLE>rezide7Z.htm: Reverse Engineering a Compressed Target (PHASE I)</TITLE>
</HEAD>

<BODY BGCOLOR=#C0C0C0 TEXT=#001010 VLINK=#405040>
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%  HEIGHT="22">
<TR><td></td>
<td>
<!-- Choose  a TITLE probably wont be changed -->
<center><FONT SIZE="+2">Reverse Engineering a Compressed Target (Phase I)</fonT><br>
        <FONT SIZE="+1">A surgical attack (we cut open the target, repair the damage, then stitch it up again)</fonT>
</center>
</td>

<td>
<!-- Choose  a PROJECT GIF, leave this if unsure -->
<center><a href="projunpa.htm" tppabs="http://ftp.fravia.org/projunpa.htm"><IMG SRC="packers.gif" tppabs="http://ftp.fravia.org/packers.gif" ALT="packers" ALIGN=BOTTOM WIDTH=114 
EIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>
<br>
<font color=gray>Packers</FonT>
</center></td></tr>
<tR>
<td bgcolor="#FFFFEA"><center>
<FONT COLOR="890000">
<!-- CHOOSE A DATE (will probably be changed) -->
5 May 1998
</FONT></center>
</td>
<td bgcolor="#FFFFEA"><center>by <font size=+3>
<!-- CHOOSE A HANDLE (wont be changed) -->
+ReZiDeNt
</fonT></center>
</td>
<td VALIGN="center" bgcolor="#FFFFEA">
<center>
<a href="hcu98_3.htm" tppabs="http://ftp.fravia.org/hcu98_3.htm"><IMG SRC="hcu1.gif" tppabs="http://ftp.fravia.org/hcu1.gif" ALT="+cracker" ALIGN=BOTTOM 
WIDTH=114 HEIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a>
<br>
<font color=gray>+Cracker</FonT>
</center>
</td>
</tr>
<TR><td><center><a href="index.html" tppabs="http://ftp.fravia.org/index.html"><IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALIGN="BOTTOM" 
BORDER="0" VSPACE="0" HSPACE="0"></a></center></td>
<TD BGCOLOR="898030"><center>Courtesy of Fravia's page of 
reverse engineering</center> 
</center></TD>
<td BGCOLOR="898030">
<center>
"Europaized" by fravia+ :-) </center></td>
</TR>
<!-- this is for the data.....fra_00xx....yymmdd....handle..beg+int...not ass... -->
<tr><td><font color="#C4C0CF">fra_00xx<bR>980505<br>+Rezident<br>0110<br>PU<br>PC<br></fonT></td><td><i><center>
An essay by +ReZiDeNt! There is actually no need for comments, Yet I will comment it nevertheless...
<br>1) I have added 
"Phase I" to the title because I hope there will be some phase II, III, IV, you name it... I love 
+crackers that EXPLAIN things instead of simply (and boringly) cracking a given, hyperspecific, 
target's 
protection :-)<br>
2) Am I mistaken or +ReZiDeNt is working quite a lot on 'his'  
"beep" cracking techniques? :-)<br>3) This essay is a MUST for all reversers that want 
to understand how to tackle packed files.<br>4) This essay reminds us (once more) of the 
NEED to crack "oldies" (i.e. DOS targets) in order to better understand reversing... so strange 
it may seem for some of you: the last windows protections are (often, not always) very easy 
to reverse and the old DOS protections are (often, not always) very cleverly drafted... speak 
of programmers' development and progress... it's an aera of programming "decadence"... 
unfortunately, 
and you should thank Billyboy for this :-( 
</i></center></td>
<td></td>
</tr>
<TR><td></td>
<!-- Leonard Coehn's old song, because we are poets, not only crackers -->
<TD BGCOLOR="898030"><center></i><b>There is a crack, a crack in everything 
That's how the light gets in</b></center>
<!-- Leonard Coehn's old song, because we are poets, not only crackers -->
</center></TD><td></td>
</TR>
<TR>
<td VALIGN= "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>
Rating</FONT></FONT></center>
</TD>
<td VALIGN = "MIDDLE" bgcolor="#C6E7C6"><font color=blue><center>
<!-- CHOOSE A RATING (may be changed) -->
( )<B>Beginner</B> (x)<B>Intermediate</B> ( )<B>Advanced</B> ( )<B>Expert</B></FONT>
</center></td>
<td></td></tr></table><bR>
<!-- CHOOSE A COMMENT (may be changed)  -->
Those interested in DOS targets for a change might want to take a read of this, remember the old DOS days.<br>
<hR>
<center>
   <FONT SIZE="+2">
<!-- CHOOSE A TITLE (wont probably be changed) -->
Reverse Engineering a Compressed Target (Phase I)
   </FONT><BR>
   <FONT SIZE="+2">
<!-- CHOOSE A SUBTITLE (wont proabbly be changed) -->
A surgical attack (we cut open the target, repair the damage, then stitch it up again)
   </FONT><BR>
   <FONT COLOR="0B7FC1">
<!-- REPEAT YOUR CHOSEN HANDLE HERE -->Written by 
+ReZiDeNt
   </FONT>
</center><br>

<!-- INTRO STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Introduction</fonT>
</fonT></center></td></tr></table>
<p>
<!-- PASTE HERE YOUR INTRODUCTION -->
Before I start I want to make something clear. I am reversing this
program  because I want to see what "makes it tick", or put another way,
to learn. In most parts of the world (and most definitely within those
countries swallowed by the "European
Union") this is perfectly legal and legitimate. I do not use this program
(it has been deleted from my computer) and I have not released a patch for
it - and don't let me catch you making a crack with the info from this
essay - if you do you will be regarded as a "lamer" by +all! You have been
warned.
</p>
<br>

<!-- TOOLS STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Tools required</fonT>
</fonT></center></td></tr></table>
<br>
<A HREF="tppmsgs/msgs2.htm#245" tppabs="http://www.suddendischarge.com/files/debug/tr198.zip">TR 1.98</A><br>
<A HREF="tppmsgs/msgs2.htm#246" tppabs="http://www.suddendischarge.com/files/pack/lzexe100.zip">LZEXE 1.00a</A><br>
<A HREF="tppmsgs/msgs2.htm#247" tppabs="http://www.suddendischarge.com/files/unpack/unp412b.zip">UNP 4.12b</A><br>
A hex editor (e.g. UltraEdit)
<!-- PASTE HERE YOUR REQUIRED TOOLS -->
<br><br>

<!-- TARGET URL STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Target's URL/FTP</fonT>
</fonT></center></td></tr></table>
<!-- DON'T FORGET TO PASTE HERE THE URL/FTP OF YOUR TARGET(S) -->
<br>
<A HREF="tppmsgs/msgs2.htm#248 tppabs="http://www1.tu-chemnitz.de/ftp-home/pub/simtelnet/msdos/txtutl/simdoc30.zi"p">Simply Docs 3.0</A>
<br><br>

<!-- PROGRAM HISTORY STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Program History</fonT>
</fonT></center></td></tr></table>
<!-- PASTE HERE YOUR TARGET'S HISTORY (if any) -->
<br>
This program dates back to 1994, "sans Windoze 95" days - that's all I know :-)
<br><br>

<!-- REAL ESSAY  STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Essay</fonT></fonT>
</center></td></tr></table>
<br><pre>
I'm going to abandon our beloved SoftICE for now, and instead turn our
attentions to a clever little program called TR. This incredible tool is
easily available as shareware all over the internet (you do know <a href="howtosea.htm" tppabs="http://ftp.fravia.org/howtosea.htm">how to
search</a> don't you? If not, go away and learn, come back and rejoin the rest
of the +class later), and it has some very nice features. It is very
compact, has an interface very similar to SoftICE and it can also be used
to unpack files. It works find in a DOS box under Windoze 95, and although
it can only debug DOS programs it is still very useful. It is capable of
evading quite a few tricks that would crash other debuggers/tracers.

On to the target, Simply Docs 3.0. This is a program that you can use to
create self-displaying text files, with a nice little menu, options to
print, load as a TSR etc. This is a fairly old program, you might have
trouble locating it, I don't think it is being sold anymore.

Anyway, any document EXE you create with the shareware version of this
application has a little nag screen at the beginning. This nag screen is
preceded by an irritating beep, and in order to get past the nag screen
you must push the random number indicated. Presumably this is to ensure
that the nag screen lives up to its name.

If we want to remove the nag, we run into a little problem. Since the
program generates EXEs, how can we stop it from inserting the nag? There
is no way of registering the application (the author will instead snail
mail you a floppy with the complete version), so where do we start? Well,
first use the program to create a little test EXE. Stepping through it
with TR, we find the below call:


:065B  9A0200A443   CALL FAR  43A4:0002      ; beep!


Continuing our exploration, we step over a number of repetitious
instructions that display the nag, before we arrive at the below:


:075B  833E10031B   CMP       [WORD 0310],1B ; did the user push a key?
:0760  7503         JNE       0765           ; jump if not 'ESC'
:0762  E9D513       JMP       1B3A           ; exit from program
:0765  A19C02       MOV       AX,[029C]      ; load key user must push
:0768  053000       ADD       AX,0030        ; add 0x30 to get ASCII char
:076B  3B061003     CMP       AX,[0310]      ; compare with key pushed
:076F  75E7         JNE       0758           ; beggar off if wrong
:0771  A11203       MOV       AX,[0312]      ; else end the nag!


So to jump over the nag we can just replace the call to the beep function
with 'JMP 0771' - well, not quite. Try to search for the necessary hex
chars in the test EXE, you won't find them. The reason for this is that
the EXE is compressed, so it's time to get out our next tool, UNP, to
unpack the EXE. You will find that UNP reports that the EXE was compressed
using LZEXE V0.91 or V1.00a. Unpack the EXE and patch it (no, I'm not
going to give you the hex string - I'm writing this to show you a method,
not to give you a crack).

Once we have done this we can patch the EXE and run it without the nag.
CRASH! No, it doesn't work! This is because the program has been generated
believing it is compressed, uncompressing it messes it up. We need to
recompress the EXE, so enter the third tool, LZEXE (get version 1.00a from
http://www.suddendischarge.com). Using this we can repack the EXE and now
it works nicely, no nag at all.

OK, but this is nothing special, we've haven't actually reversed Simply
Docs at all, so let's get to work on it. This is where a little 'Zen' is
needed. Looking in the Simply Docs directory, you will notice two little
files called SDOC1.OVL and SDOC2.OVL - if you look at them with a hex
editor you will see that they have an EXE header, and they are also
compressed with LZEXE. These overlay files are where Simply Docs stores
the code which it 'wraps' around your textfile to make a self-displaying
EXE. Using just a little intelligence, you should immediately realise that
this is where the protection is hidden.

Uncompress SDOC1.OVL and step through it using TR (yes, you can step
through it!) - let it run and it will exit with the message 'unable to
open document'. This confirms our suspicions that this is where the reader
code resides. Using a hex editor you can patch this file in exactly the
same way as the test EXE we made earlier (search for the same hex string
and patch it)! Now recompress the patched SDOC1.OVL using LZEXE and make
another test EXE - no nag! Simply Docs will now make nag-free
self-displaying EXEs.

You might be wondering what SDOC2.OVL is for - if you look around the
Simply Docs program, you will find that there are two version of the
reader - a full version and a 'lite' version, with fewer options. The
SDOC1.OVL contains the reader code for the full version, while SDOC2.OVL
stores the code for the 'lite' version. I'll leave it as an exercise to
the reader to investigate the SDOC2.OVL, but it can be patched in the very
same way (but the hex string is a little different).

Anyway, the moral of this story is that we should not neglect old DOS
targets, there are often many ingenious and unusual protections lurking
inside them, and reversing them can be a lot of fun and a good way to
sharpen your 'claws' (as I did with this target).


Good Hunting,
+ReZiDeNt
<!-- PASTE HERE THE TEXT OF YOUR ESSAY
     THIS IS OF COURSE THE MOST IMPORTANT PART
     PLEASE CHECK THE MARGINS WHEN YOU ARE FINISHED! 
     SHOULD NOT BLAST NETSCAPE MARGINS OUT! HAVE A LOOK INSIDE
     YOUR OWN BROWSER WHEN YOU HAVE FINISHED!  -->
</prE>
<br><br>

<!-- FINAL NOTES STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Final Notes</fonT>
</fonT></center></td></tr></table>
<pre>
Keep an eye out for older programs with interesting protections! <!-- PASTE HERE YOUR FINAL NOTES (if any) -->
</pre>
<br>

<!-- OB DUH STARTS HERE -->
<TABLE CELLPADDING="1" CELLSPACING="2" BORDER="1" WIDTH= "100%"  HEIGHT="22" >
<tr><td bgcolor="#C6E7C6"><center><font size=+2><font color=blue>Ob Duh</fonT></fonT>
</center></td></tr></table>
 <center>
   <i>I wont even bother explaining you 
   that you should BUY this target program if you intend to use it for a longer 
   period than the allowed one. Should you want 
   to STEAL this software instead, you don't need to crack its protection 
   scheme at all: you'll 
   find it on most Warez sites, complete and already regged, farewell.</i>
</center>

<!-- WAY OUT STARTS HERE -->
<hr>
<center><i>You are deep inside fravia's page of reverse engineering,  
choose your way out:</i></center>
<br><center>
<!-- EITHER A NICE GIF LIKE THIS -->

<a href="projunpa.htm" tppabs="http://ftp.fravia.org/projunpa.htm"><IMG SRC="packers.gif" tppabs="http://ftp.fravia.org/packers.gif" ALT="packers" ALIGN=BOTTOM WIDTH=114 
EIGHT=43 BORDER=0 VSPACE=0 HSPACE=0></a><br>
<font color=gray>Back to projunpa</FonT>
<br><bR>

<!-- OR JUST A LINK LIKE THIS -->

<!--
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="project1.htm" tppabs="http://ftp.fravia.org/project1.htm">Back to Your_chosen_project</A> 
<hr width=33%>
-->

<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="index.html" tppabs="http://ftp.fravia.org/index.html">homepage</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="links.htm" tppabs="http://ftp.fravia.org/links.htm">links</A> 
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="searengi.htm" tppabs="http://ftp.fravia.org/searengi.htm">search_forms</A>

<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="orc.htm" tppabs="http://ftp.fravia.org/orc.htm">+ORC</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="student.htm" tppabs="http://ftp.fravia.org/student.htm">students' essays</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="academy.htm" tppabs="http://ftp.fravia.org/academy.htm">academy database</A>
<br>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="realicra.htm" tppabs="http://ftp.fravia.org/realicra.htm">reality cracking</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="howtosea.htm" tppabs="http://ftp.fravia.org/howtosea.htm">how to search</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="javascri.htm" tppabs="http://ftp.fravia.org/javascri.htm">javascript wars</A>
<br>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="tools.htm" tppabs="http://ftp.fravia.org/tools.htm">tools</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="noanon.htm" tppabs="http://ftp.fravia.org/noanon.htm">anonymity academy</A> 
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="cocktail.htm" tppabs="http://ftp.fravia.org/cocktail.htm">cocktails</A>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="tppmsgs/msgs1.htm#137" tppabs="http://fravia.org/ideale.htm">antismut CGI-scripts</A>

<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="info.htm" tppabs="http://ftp.fravia.org/info.htm">mail_fravia+</A>
<br>
<IMG SRC="bulletr.gif" tppabs="http://ftp.fravia.org/bulletr.gif" ALT="red" ALIGN=BOTTOM WIDTH=13 HEIGHT=13 
BORDER=0 VSPACE=0 HSPACE=0><A HREF="legal.htm" tppabs="http://ftp.fravia.org/legal.htm">Is reverse engineering legal?</A>
</CENTER>
<hr>
<!-- THAT'S ALL, THANKS A LOT this will allow automated retrieval -->
</BODY>
</HTML>
